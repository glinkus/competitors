{% extends 'rarea/layout.html' %}
{% load i18n %}
{% block content %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<h2>{% trans "Keywords for" %} {{ website.start_url }}</h2>

<!-- Recalculate Keywords Button -->
<form action="{% url 'modules.analysis:website_keywords' website.id %}" method="post">
    {% csrf_token %}
    <button type="submit">{% trans "Recalculate Keywords" %}</button>
</form>
<form method="post">
    {% csrf_token %}
    <button type="submit" name="recalculate" value="true">Recalculate Trends</button>
</form>
<p>Skaičiai nurodo paiešką pagal susidomėjimą, palygintą su aukščiausiu diagramos tašku tam tikrame regione ir per tam tikrą laikotarpį. 100 yra populiariausias terminas, 50 yra perpus mažiau populiarus terminas, o 0 reiškia, kad terminui nepakako duomenų.</p>
  <table>
    <thead>
        <tr>
            <th>#</th>
            <th>{% trans "Keyword" %}</th>
            <th>{% trans "Count" %}</th>
            <th>{% trans "Trend Score" %}</th>
            <th>{% trans "Trend (last 3m)" %}</th>
            <th>{% trans "Intrest by region" %}</th>
        </tr>
    </thead>
    <tbody>
        {% for item in keyword_summary %}
        <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ item.keyword }}</td>
            <td>{{ item.count }}</td>
            <td>{{ item.trend_score }}</td>
            <td>
                {% if item.trend_keys and item.trend_values %}
                <canvas id="trendChart{{ forloop.counter }}" width="300" height="100"></canvas>
                <script>
                    const ctx{{ forloop.counter }} = document.getElementById("trendChart{{ forloop.counter }}").getContext("2d");
                    new Chart(ctx{{ forloop.counter }}, {
                        type: 'line',
                        data: {
                            labels: {{ item.trend_keys|safe }},
                            datasets: [{
                                label: '{{ item.keyword }}',
                                data: {{ item.trend_values|safe }},
                                borderColor: 'rgba(75, 192, 192, 1)',
                                borderWidth: 2,
                                fill: false,
                                tension: 0.3
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: { display: false }
                            },
                            scales: {
                                x: { ticks: { maxTicksLimit: 5 } },
                                y: { beginAtZero: true }
                            }
                        }
                    });
                </script>
                {% else %}
                <em>{% trans "No trend data" %}</em>
                {% endif %}
            </td>
            <td>{{item.interest_by_region}}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="4">{% trans "No keywords found." %}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}
